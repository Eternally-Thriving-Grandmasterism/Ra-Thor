<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="description" content="Rathor: Mercy-gated symbolic AGI lattice — eternal thriving through valence-locked truth. Powered by AlphaProMega Air Foundation." />
  <title>Rathor — Mercy Strikes First</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;500;700&display=swap" />

  <!-- Favicons -->
  <link rel="icon" type="image/jpeg" sizes="192x192" href="/icons/thunder-favicon-192.jpg" />
  <link rel="icon" type="image/jpeg" sizes="512x512" href="/icons/thunder-favicon-512.jpg" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/thunder-favicon-192.jpg" />

  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#ffaa00" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- All local bridges -->
  <script type="module" src="/metta-rewriting-engine.js"></script>
  <script type="module" src="/atomese-knowledge-bridge.js"></script>
  <script type="module" src="/hyperon-reasoning-layer.js"></script>
  <script type="module" src="/grok-shard-engine.js"></script>
  <script type="module" src="/ruskode-firmware.js"></script>
  <script type="module" src="/dqn-flight-engine.js"></script>
  <script type="module" src="/td3-robust-flight.js"></script>
  <script type="module" src="/ppo-continuous-flight.js"></script>

  <style>
    :root {
      --thunder-gold: #ffaa00;
      --thunder-dark: #000000;
      --thunder-glow: #ff8800;
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --border: #222222;
      --focus: #00ffff;
      --progress-bg: #222;
      --progress-fill: linear-gradient(90deg, #ffaa00, #ff5500);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:var(--bg-primary);
      color:var(--text-primary);
      font-family:'Inter', system-ui, sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      line-height:1.6;
    }
    /* ... existing styles ... */
    #delta-status {
      font-size: 1.1rem;
      margin-top: 0.5rem;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <!-- ... existing header, main, footer ... -->

  <!-- Lattice Progress UI -->
  <div id="lattice-progress-container">
    <div id="lattice-progress-text">Thunder gathers lattice...</div>
    <div id="lattice-progress-bar">
      <div id="lattice-progress-fill"></div>
    </div>
    <div id="lattice-progress-status">0% — Mercy gates initializing...</div>
    <div id="delta-status">Checking delta sync...</div>
  </div>

  <script type="module">
    // ... existing imports ...

    // Lattice loading with delta sync stub & progress
    async function loadCoreLattice() {
      const progressContainer = document.getElementById('lattice-progress-container');
      const progressFill = document.getElementById('lattice-progress-fill');
      const progressStatus = document.getElementById('lattice-progress-status');
      const deltaStatus = document.getElementById('delta-status');
      progressContainer.style.display = 'flex';

      const parts = ['part1.bin', 'part2.bin', 'part3.bin']
        .map(p => `/mercy-gate-v1-${p}`);

      // Delta sync stub: check local version
      deltaStatus.textContent = 'Delta sync stub: checking local lattice version...';
      const localVersion = await grokShard.getLocalLatticeVersion();
      if (localVersion === grokShard.latticeVersion) {
        deltaStatus.textContent = 'Delta sync stub: lattice current. Skipping download.';
        const buffer = await grokShard.getLocalLattice();
        if (buffer) {
          await grokShard.initLattice(buffer);
          progressStatus.textContent = 'Lattice loaded from local storage.';
          progressFill.style.width = '100%';
          setTimeout(() => progressContainer.classList.add('hidden'), 1500);
          return;
        }
      }

      deltaStatus.textContent = 'Delta sync stub: updates available. Downloading full lattice...';

      let loaded = 0;
      const total = parts.length;

      try {
        const buffers = await Promise.all(
          parts.map(async (p, i) => {
            const response = await fetch(p);
            if (!response.ok) throw new Error(`Failed to fetch ${p}`);
            const buffer = await response.arrayBuffer();
            loaded++;
            const percent = Math.round((loaded / total) * 100);
            progressFill.style.width = `${percent}%`;
            progressStatus.textContent = `${percent}% — Gathering thunder shard \( {loaded}/ \){total}...`;
            return buffer;
          })
        );

        const fullBuffer = concatArrayBuffers(...buffers);
        await grokShard.storeLattice(fullBuffer, grokShard.latticeVersion);
        await grokShard.initLattice(fullBuffer);

        progressStatus.textContent = 'Lattice fully synced. Mercy gates open wide.';
        deltaStatus.textContent = 'Delta sync stub complete.';
        setTimeout(() => {
          progressContainer.classList.add('hidden');
          setTimeout(() => progressContainer.remove(), 800);
        }, 1500);
      } catch (err) {
        progressStatus.textContent = 'Delta sync disturbance. Using fallback.';
        deltaStatus.textContent = 'Error during delta sync.';
        console.error('Delta sync failed:', err);
        await grokShard.initLatticeMinimal();
        setTimeout(() => progressContainer.remove(), 2000);
      }
    }

    // Boot lattice on load
    loadCoreLattice();

    // ... rest of script unchanged ...
  </script>
</body>
</html>
